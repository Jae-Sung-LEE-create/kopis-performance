{% extends "base.html" %}

{% set lang = g.lang if g.lang else 'ko' %}

{% block title %}
    {% if lang == 'en' %}Home - KOPIS Performing Arts Platform{% elif lang == 'ja' %}ホーム - KOPIS公演プラットフォーム{% elif lang == 'zh' %}首页 - KOPIS演出宣传平台{% else %}홈 - KOPIS 공연 홍보 플랫폼{% endif %}
{% endblock %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container mt-3">
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                    <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<!-- 새로운 멋진 Hero Section -->
<div class="hero-section">
    <div class="hero-background">
        <div class="hero-particles"></div>
        <div class="hero-gradient"></div>
    </div>
    <div class="container text-center">
        <div class="hero-content">
            <!-- 메인 타이틀 -->
            <div class="main-title-wrapper">
                <h1 class="main-title animate-title">
                    {% if lang == 'en' %}Notice{% elif lang == 'ja' %}お知らせ{% elif lang == 'zh' %}公告{% else %}공고{% endif %}
                </h1>
                <div class="title-underline"></div>
            </div>
            
            <!-- 서브타이틀 -->
            <div class="main-subtitle-wrapper">
                <div class="main-subtitle animate-subtitle">
                    <span class="highlight-text">(공)연</span> + <span class="highlight-text">(고)go</span>
                </div>
                <div class="subtitle-decoration">
                    <i class="fas fa-star star-1"></i>
                    <i class="fas fa-star star-2"></i>
                    <i class="fas fa-star star-3"></i>
                </div>
            </div>
            
            <!-- 설명 -->
            <div class="main-desc-wrapper">
                <p class="main-desc animate-desc">
                    {% if lang == 'en' %}Promote your stage easily for everyone.{% elif lang == 'ja' %}誰でも簡単に自分の舞台を宣伝できます。{% elif lang == 'zh' %}任何人都可以轻松宣传自己的舞台。{% else %}누구나 간편하게 본인의 무대를 홍보하세요.{% endif %}
                </p>
            </div>
            
            <!-- 액션 버튼 -->
            <div class="hero-actions">
                {% if current_user.is_authenticated %}
                    <a href="/submit" class="btn btn-hero-primary animate-btn">
                        <div class="btn-content">
                            <i class="fas fa-plus btn-icon"></i>
                            <span class="btn-text">
                                {% if lang == 'en' %}Submit Performance{% elif lang == 'ja' %}公演申請{% elif lang == 'zh' %}申请演出{% else %}공연 신청하기{% endif %}
                            </span>
                        </div>
                        <div class="btn-glow"></div>
                    </a>
                {% else %}
                    <div class="btn-group-hero">
                        <a href="/login" class="btn btn-hero-secondary animate-btn">
                            <div class="btn-content">
                                <i class="fas fa-sign-in-alt btn-icon"></i>
                                <span class="btn-text">
                                    {% if lang == 'en' %}Login{% elif lang == 'ja' %}ログイン{% elif lang == 'zh' %}登录{% else %}로그인{% endif %}
                                </span>
                            </div>
                        </a>
                        <a href="/register" class="btn btn-hero-outline animate-btn">
                            <div class="btn-content">
                                <i class="fas fa-user-plus btn-icon"></i>
                                <span class="btn-text">
                                    {% if lang == 'en' %}Sign Up{% elif lang == 'ja' %}新規登録{% elif lang == 'zh' %}注册{% else %}회원가입{% endif %}
                                </span>
                            </div>
                        </a>
                    </div>
                {% endif %}
            </div>
            
            <!-- 스크롤 인디케이터 -->
            <div class="scroll-indicator">
                <div class="scroll-arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="scroll-text">
                    {% if lang == 'en' %}Scroll to explore{% elif lang == 'ja' %}スクロールして探索{% elif lang == 'zh' %}滚动探索{% else %}스크롤하여 탐색{% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- 검색 및 필터 UI -->
    <div class="row mb-4">
        <div class="col-12">
            <!-- 검색창 -->
            <div class="mb-3">
                <form method="GET" action="/" class="d-flex gap-2">
                    <input type="text" name="search" class="form-control form-control-lg" 
                           placeholder="{% if lang == 'en' %}Search by performance title or team name...{% elif lang == 'ja' %}公演タイトルまたはチーム名で検索...{% elif lang == 'zh' %}请输入演出标题或团队名称...{% else %}공연 제목 또는 팀명을 검색하세요...{% endif %}"
                           value="{{ search }}">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>
            
            <!-- 필터 버튼들 -->
            <div class="row g-3 mb-3">
                <!-- 날짜별 필터 -->
                <div class="col-md-3">
                    <select name="date_filter" class="form-select" onchange="applyFilter('date_filter', this.value)">
                        <option value="">{% if lang == 'en' %}All Periods{% elif lang == 'ja' %}全期間{% elif lang == 'zh' %}全部时间{% else %}전체 기간{% endif %}</option>
                        <option value="this_week" {% if date_filter == 'this_week' %}selected{% endif %}>{% if lang == 'en' %}This Week{% elif lang == 'ja' %}今週{% elif lang == 'zh' %}本周{% else %}이번 주{% endif %}</option>
                        <option value="this_month" {% if date_filter == 'this_month' %}selected{% endif %}>{% if lang == 'en' %}This Month{% elif lang == 'ja' %}今月{% elif lang == 'zh' %}本月{% else %}이번 달{% endif %}</option>
                        <option value="next_month" {% if date_filter == 'next_month' %}selected{% endif %}>{% if lang == 'en' %}Next Month{% elif lang == 'ja' %}来月{% elif lang == 'zh' %}下月{% else %}다음 달{% endif %}</option>
                    </select>
                </div>
                
                <!-- 지역별 필터 -->
                <div class="col-md-3">
                    <select name="location" class="form-select" onchange="applyFilter('location', this.value)">
                        <option value="">{% if lang == 'en' %}All Regions{% elif lang == 'ja' %}全地域{% elif lang == 'zh' %}全部地区{% else %}전체 지역{% endif %}</option>
                        <option value="서울특별시" {% if location == '서울특별시' %}selected{% endif %}>{% if lang == 'en' %}Seoul{% elif lang == 'ja' %}ソウル特別市{% elif lang == 'zh' %}首尔特别市{% else %}서울특별시{% endif %}</option>
                        <option value="경기도" {% if location == '경기도' %}selected{% endif %}>{% if lang == 'en' %}Gyeonggi-do{% elif lang == 'ja' %}京畿道{% elif lang == 'zh' %}京畿道{% else %}경기도{% endif %}</option>
                        <option value="강원도" {% if location == '강원도' %}selected{% endif %}>{% if lang == 'en' %}Gangwon-do{% elif lang == 'ja' %}江原道{% elif lang == 'zh' %}江原道{% else %}강원도{% endif %}</option>
                        <option value="인천광역시" {% if location == '인천광역시' %}selected{% endif %}>{% if lang == 'en' %}Incheon{% elif lang == 'ja' %}仁川広域市{% elif lang == 'zh' %}仁川广域市{% else %}인천광역시{% endif %}</option>
                        <option value="충청남도" {% if location == '충청남도' %}selected{% endif %}>{% if lang == 'en' %}Chungcheongnam-do{% elif lang == 'ja' %}忠清南道{% elif lang == 'zh' %}忠清南道{% else %}충청남도{% endif %}</option>
                        <option value="충청북도" {% if location == '충청북도' %}selected{% endif %}>{% if lang == 'en' %}Chungcheongbuk-do{% elif lang == 'ja' %}忠清北道{% elif lang == 'zh' %}忠清北道{% else %}충청북도{% endif %}</option>
                        <option value="세종특별자치시" {% if location == '세종특별자치시' %}selected{% endif %}>{% if lang == 'en' %}Sejong{% elif lang == 'ja' %}世宗特別自治市{% elif lang == 'zh' %}世宗特别自治市{% else %}세종특별자치시{% endif %}</option>
                        <option value="대전광역시" {% if location == '대전광역시' %}selected{% endif %}>{% if lang == 'en' %}Daejeon{% elif lang == 'ja' %}大田広域市{% elif lang == 'zh' %}大田广域市{% else %}대전광역시{% endif %}</option>
                        <option value="경상북도" {% if location == '경상북도' %}selected{% endif %}>{% if lang == 'en' %}Gyeongsangbuk-do{% elif lang == 'ja' %}慶尚北道{% elif lang == 'zh' %}庆尚北道{% else %}경상북도{% endif %}</option>
                        <option value="대구광역시" {% if location == '대구광역시' %}selected{% endif %}>{% if lang == 'en' %}Daegu{% elif lang == 'ja' %}大邱広域市{% elif lang == 'zh' %}大邱广域市{% else %}대구광역시{% endif %}</option>
                        <option value="전라북도" {% if location == '전라북도' %}selected{% endif %}>{% if lang == 'en' %}Jeollabuk-do{% elif lang == 'ja' %}全羅北道{% elif lang == 'zh' %}全罗北道{% else %}전라북도{% endif %}</option>
                        <option value="경상남도" {% if location == '경상남도' %}selected{% endif %}>{% if lang == 'en' %}Gyeongsangnam-do{% elif lang == 'ja' %}慶尚南道{% elif lang == 'zh' %}庆尚南道{% else %}경상남도{% endif %}</option>
                        <option value="울산광역시" {% if location == '울산광역시' %}selected{% endif %}>{% if lang == 'en' %}Ulsan{% elif lang == 'ja' %}蔚山広域市{% elif lang == 'zh' %}蔚山广域市{% else %}울산광역시{% endif %}</option>
                        <option value="부산광역시" {% if location == '부산광역시' %}selected{% endif %}>{% if lang == 'en' %}Busan{% elif lang == 'ja' %}釜山広域市{% elif lang == 'zh' %}釜山广域市{% else %}부산광역시{% endif %}</option>
                        <option value="광주광역시" {% if location == '광주광역시' %}selected{% endif %}>{% if lang == 'en' %}Gwangju{% elif lang == 'ja' %}光州広域市{% elif lang == 'zh' %}光州广域市{% else %}광주광역시{% endif %}</option>
                        <option value="전라남도" {% if location == '전라남도' %}selected{% endif %}>{% if lang == 'en' %}Jeollanam-do{% elif lang == 'ja' %}全羅南道{% elif lang == 'zh' %}全罗南道{% else %}전라남도{% endif %}</option>
                        <option value="제주도" {% if location == '제주도' %}selected{% endif %}>{% if lang == 'en' %}Jeju-do{% elif lang == 'ja' %}済州道{% elif lang == 'zh' %}济州道{% else %}제주도{% endif %}</option>
                    </select>
                    {% if location %}
                    <small class="form-text text-info">
                        <i class="fas fa-info-circle me-1"></i>
                        {% if lang == 'en' %}Filtering by address region{% elif lang == 'ja' %}住所地域でフィルタリング{% elif lang == 'zh' %}按地址地区筛选{% else %}주소 지역으로 필터링 중{% endif %}
                    </small>
                    {% endif %}
                </div>
                
                <!-- 가격 범위 필터 -->
                <div class="col-md-3">
                    <select name="price_range" class="form-select" onchange="applyPriceFilter(this.value)">
                        <option value="">{% if lang == 'en' %}All Prices{% elif lang == 'ja' %}全価格{% elif lang == 'zh' %}全部价格{% else %}전체 가격{% endif %}</option>
                        <option value="0-50000" {% if price_range == '0-50000' %}selected{% endif %}>{% if lang == 'en' %}Under ₩50,000{% elif lang == 'ja' %}₩50,000以下{% elif lang == 'zh' %}₩50,000以下{% else %}₩50,000 이하{% endif %}</option>
                        <option value="50000-100000" {% if price_range == '50000-100000' %}selected{% endif %}>{% if lang == 'en' %}₩50,000 - ₩100,000{% elif lang == 'ja' %}₩50,000 - ₩100,000{% elif lang == 'zh' %}₩50,000 - ₩100,000{% else %}₩50,000 - ₩100,000{% endif %}</option>
                        <option value="100000-200000" {% if price_range == '100000-200000' %}selected{% endif %}>{% if lang == 'en' %}₩100,000 - ₩200,000{% elif lang == 'ja' %}₩100,000 - ₩200,000{% elif lang == 'zh' %}₩100,000 - ₩200,000{% else %}₩100,000 - ₩200,000{% endif %}</option>
                        <option value="200000-500000" {% if price_range == '200000-500000' %}selected{% endif %}>{% if lang == 'en' %}₩200,000 - ₩500,000{% elif lang == 'ja' %}₩200,000 - ₩500,000{% elif lang == 'zh' %}₩200,000 - ₩500,000{% else %}₩200,000 - ₩500,000{% endif %}</option>
                        <option value="500000-1000000" {% if price_range == '500000-1000000' %}selected{% endif %}>{% if lang == 'en' %}₩500,000 - ₩1,000,000{% elif lang == 'ja' %}₩500,000 - ₩1,000,000{% elif lang == 'zh' %}₩500,000 - ₩1,000,000{% else %}₩500,000 - ₩1,000,000{% endif %}</option>
                        <option value="1000000-2000000" {% if price_range == '1000000-2000000' %}selected{% endif %}>{% if lang == 'en' %}₩1,000,000 - ₩2,000,000{% elif lang == 'ja' %}₩1,000,000 - ₩2,000,000{% elif lang == 'zh' %}₩1,000,000 - ₩2,000,000{% else %}₩1,000,000 - ₩2,000,000{% endif %}</option>
                        <option value="custom" {% if price_range == 'custom' %}selected{% endif %}>{% if lang == 'en' %}Custom Range{% elif lang == 'ja' %}カスタム範囲{% elif lang == 'zh' %}自定义范围{% else %}사용자 지정{% endif %}</option>
                    </select>
                    
                    <!-- 사용자 지정 가격 범위 (기본적으로 숨김) -->
                    <div id="customPriceRange" class="mt-2" style="display: none;">
                        <div class="d-flex align-items-center gap-2 mb-2">
                            <input type="number" id="priceMin" class="form-control form-control-sm" 
                                   placeholder="0" min="0" max="2000000" step="10000" 
                                   value="{{ price_min or '' }}" style="width: 80px;">
                            <span class="text-muted">~</span>
                            <input type="number" id="priceMax" class="form-control form-control-sm" 
                                   placeholder="2000000" min="0" max="2000000" step="10000" 
                                   value="{{ price_max or '' }}" style="width: 80px;">
                            <span class="text-muted">원</span>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="applyCustomPriceRange()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="price-slider-container">
                            <div id="priceSlider" class="price-slider"></div>
                            <div class="d-flex justify-content-between mt-1">
                                <small class="text-muted">0원</small>
                                <small class="text-muted">200만원</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 필터 초기화 -->
                <div class="col-md-3">
                    <label class="form-label">&nbsp;</label>
                    <a href="/" class="btn btn-outline-secondary w-100">
                        <i class="fas fa-undo me-2"></i>{% if lang == 'en' %}Reset Filters{% elif lang == 'ja' %}フィルター初期化{% elif lang == 'zh' %}重置筛选{% else %}필터 초기화{% endif %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 메인 카테고리 버튼 UI -->
    <div class="row mb-3">
        <div class="col-12 text-center">
            <!-- 메인 카테고리 버튼 직접 분기 -->
            <div class="d-flex flex-wrap justify-content-center gap-2 mb-3">
                <a href="/?main_category=전체" class="btn btn-outline-primary btn-lg btn-main-category {% if selected_main_category=='전체' or not selected_main_category %}active{% endif %}">
                    <i class="fas fa-list me-2"></i>{% if lang == 'en' %}All{% elif lang == 'ja' %}全体{% elif lang == 'zh' %}全部{% else %}전체{% endif %}
                </a>
                <a href="/?main_category=공연" class="btn btn-outline-primary btn-lg btn-main-category {% if selected_main_category=='공연' %}active{% endif %}">
                    <i class="fas fa-music me-2"></i>{% if lang == 'en' %}Performance{% elif lang == 'ja' %}公演{% elif lang == 'zh' %}演出{% else %}공연{% endif %}
                </a>
                <a href="/?main_category=대회" class="btn btn-outline-primary btn-lg btn-main-category {% if selected_main_category=='대회' %}active{% endif %}">
                    <i class="fas fa-trophy me-2"></i>{% if lang == 'en' %}Competition{% elif lang == 'ja' %}大会{% elif lang == 'zh' %}大赛{% else %}대회{% endif %}
                </a>
            </div>
            <!-- 세부 카테고리 버튼 직접 분기 -->
            {% if selected_main_category == '공연' or not selected_main_category %}
            <div class="d-flex flex-wrap justify-content-center gap-2">
                <a href="/?main_category=공연&category=전체" class="btn btn-outline-success btn-category {% if selected_category=='전체' or not selected_category %}active{% endif %}">{% if lang == 'en' %}All{% elif lang == 'ja' %}全体{% elif lang == 'zh' %}全部{% else %}전체{% endif %}</a>
                <a href="/?main_category=공연&category=연극" class="btn btn-outline-success btn-category {% if selected_category=='연극' %}active{% endif %}">{% if lang == 'en' %}Play{% elif lang == 'ja' %}演劇{% elif lang == 'zh' %}话剧{% else %}연극{% endif %}</a>
                <a href="/?main_category=공연&category=뮤지컬" class="btn btn-outline-success btn-category {% if selected_category=='뮤지컬' %}active{% endif %}">{% if lang == 'en' %}Musical{% elif lang == 'ja' %}ミュージカル{% elif lang == 'zh' %}音乐剧{% else %}뮤지컬{% endif %}</a>
                <a href="/?main_category=공연&category=서양음악(클래식)" class="btn btn-outline-success btn-category {% if selected_category=='서양음악(클래식)' %}active{% endif %}">{% if lang == 'en' %}Western Music (Classical){% elif lang == 'ja' %}西洋音楽（クラシック）{% elif lang == 'zh' %}西洋音乐（古典）{% else %}서양음악(클래식){% endif %}</a>
                <a href="/?main_category=공연&category=한국음악(국악)" class="btn btn-outline-success btn-category {% if selected_category=='한국음악(국악)' %}active{% endif %}">{% if lang == 'en' %}Korean Music (Gugak){% elif lang == 'ja' %}韓国音楽（国楽）{% elif lang == 'zh' %}韩国音乐（国乐）{% else %}한국음악(국악){% endif %}</a>
                <a href="/?main_category=공연&category=대중음악" class="btn btn-outline-success btn-category {% if selected_category=='대중음악' %}active{% endif %}">{% if lang == 'en' %}Pop Music{% elif lang == 'ja' %}大衆音楽{% elif lang == 'zh' %}流行音乐{% else %}대중음악{% endif %}</a>
                <a href="/?main_category=공연&category=무용(서양/한국무용)" class="btn btn-outline-success btn-category {% if selected_category=='무용(서양/한국무용)' %}active{% endif %}">{% if lang == 'en' %}Dance (Western/Korean){% elif lang == 'ja' %}舞踊（西洋/韓国）{% elif lang == 'zh' %}舞蹈（西方/韩国）{% else %}무용(서양/한국무용){% endif %}</a>
                <a href="/?main_category=공연&category=대중무용" class="btn btn-outline-success btn-category {% if selected_category=='대중무용' %}active{% endif %}">{% if lang == 'en' %}Popular Dance{% elif lang == 'ja' %}大衆舞踊{% elif lang == 'zh' %}大众舞蹈{% else %}대중무용{% endif %}</a>
                <a href="/?main_category=공연&category=서커스/마술" class="btn btn-outline-success btn-category {% if selected_category=='서커스/마술' %}active{% endif %}">{% if lang == 'en' %}Circus/Magic{% elif lang == 'ja' %}サーカス/マジック{% elif lang == 'zh' %}马戏/魔术{% else %}서커스/마술{% endif %}</a>
                <a href="/?main_category=공연&category=복합" class="btn btn-outline-success btn-category {% if selected_category=='복합' %}active{% endif %}">{% if lang == 'en' %}Mixed{% elif lang == 'ja' %}複合{% elif lang == 'zh' %}综合{% else %}복합{% endif %}</a>
            </div>
            {% elif selected_main_category == '대회' %}
            <div class="d-flex flex-wrap justify-content-center gap-2">
                <a href="/?main_category=대회&category=전체" class="btn btn-outline-warning btn-category {% if selected_category=='전체' or not selected_category %}active{% endif %}">{% if lang == 'en' %}All{% elif lang == 'ja' %}全体{% elif lang == 'zh' %}全部{% else %}전체{% endif %}</a>
                <a href="/?main_category=대회&category=댄스대회" class="btn btn-outline-warning btn-category {% if selected_category=='댄스대회' %}active{% endif %}">{% if lang == 'en' %}Dance Competition{% elif lang == 'ja' %}ダンス大会{% elif lang == 'zh' %}舞蹈大赛{% else %}댄스대회{% endif %}</a>
                <a href="/?main_category=대회&category=노래대회" class="btn btn-outline-warning btn-category {% if selected_category=='노래대회' %}active{% endif %}">{% if lang == 'en' %}Singing Competition{% elif lang == 'ja' %}歌大会{% elif lang == 'zh' %}歌唱大赛{% else %}노래대회{% endif %}</a>
                <a href="/?main_category=대회&category=연기대회" class="btn btn-outline-warning btn-category {% if selected_category=='연기대회' %}active{% endif %}">{% if lang == 'en' %}Acting Competition{% elif lang == 'ja' %}演技大会{% elif lang == 'zh' %}表演大赛{% else %}연기대회{% endif %}</a>
                <a href="/?main_category=대회&category=음악대회" class="btn btn-outline-warning btn-category {% if selected_category=='음악대회' %}active{% endif %}">{% if lang == 'en' %}Music Competition{% elif lang == 'ja' %}音楽大会{% elif lang == 'zh' %}音乐大赛{% else %}음악대회{% endif %}</a>
                <a href="/?main_category=대회&category=무용대회" class="btn btn-outline-warning btn-category {% if selected_category=='무용대회' %}active{% endif %}">{% if lang == 'en' %}Dance Competition{% elif lang == 'ja' %}舞踊大会{% elif lang == 'zh' %}舞蹈大赛{% else %}무용대회{% endif %}</a>
                <a href="/?main_category=대회&category=종합예술대회" class="btn btn-outline-warning btn-category {% if selected_category=='종합예술대회' %}active{% endif %}">{% if lang == 'en' %}Comprehensive Arts Competition{% elif lang == 'ja' %}総合芸術大会{% elif lang == 'zh' %}综合艺术大赛{% else %}종합예술대회{% endif %}</a>
            </div>
            {% endif %}
        </div>
    </div>
    <!-- 최신 공연/대회 섹션 -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-center mb-4">
                <i class="fas fa-star me-2"></i>
                {% if selected_main_category == '대회' %}
                    {% if lang == 'en' %}Latest Competition{% elif lang == 'ja' %}最新の大会{% elif lang == 'zh' %}最新大赛{% else %}최신 대회{% endif %}
                {% else %}
                    {% if lang == 'en' %}Latest Performance{% elif lang == 'ja' %}最新の公演{% elif lang == 'zh' %}最新演出{% else %}최신 공연{% endif %}
                {% endif %}
            </h2>
        </div>
    </div>

    {% if performances %}
    <div class="row">
        {% for performance in performances %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card performance-card h-100 shadow-sm">
                {% if performance.image_url %}
                <img src="{{ performance.image_url }}" class="card-img-top" alt="{{ performance.title }}" 
                     style="height: 200px; object-fit: cover;">
                {% else %}
                <div class="card-img-top bg-gradient d-flex align-items-center justify-content-center" 
                     style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="text-center text-white">
                        <i class="fas fa-music fa-3x mb-2"></i>
                        <div class="small">이미지 없음</div>
                    </div>
                </div>
                {% endif %}
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="badge bg-primary me-1">{{ performance.main_category }}</span>
                            <span class="badge bg-secondary">{{ performance.category }}</span>
                        </div>
                        <button class="btn btn-sm btn-outline-danger like-btn" data-performance-id="{{ performance.id }}">
                            <i class="fas fa-heart"></i> <span class="like-count">{{ performance.likes }}</span>
                        </button>
                    </div>
                    <h5 class="card-title">{{ performance.title }}</h5>
                    <p class="card-text text-muted">
                        <i class="fas fa-users me-1"></i>{{ performance.group_name }}
                    </p>
                    <p class="card-text">{{ performance.description[:100] }}{% if performance.description|length > 100 %}...{% endif %}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>{{ performance.date }}
                        </small>
                        <span class="badge bg-primary">₩{{ performance.price }}</span>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="d-flex gap-2">
                        <a href="/performance/{{ performance.id }}" class="btn btn-primary btn-sm flex-fill">
                            <i class="fas fa-info-circle me-1"></i>자세히 보기
                        </a>
                        {% if performance.ticket_url %}
                        <a href="{{ performance.ticket_url }}" target="_blank" class="btn btn-success btn-sm">
                            <i class="fas fa-ticket-alt"></i>
                        </a>
                        {% endif %}
                        {% if performance.is_kopis_synced %}
                        <a href="{{ performance.kopis_url }}" target="_blank" class="btn btn-info btn-sm" title="KOPIS에서 보기">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-music fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">
            {% if selected_main_category == '대회' %}
                {% if lang == 'en' %}No competitions registered yet{% elif lang == 'ja' %}まだ登録された大会がありません{% elif lang == 'zh' %}尚未注册任何大赛{% else %}아직 등록된 대회가 없습니다{% endif %}
            {% else %}
                {% if lang == 'en' %}No performances registered yet{% elif lang == 'ja' %}まだ登録された公演がありません{% elif lang == 'zh' %}尚未注册任何演出{% else %}아직 등록된 공연이 없습니다{% endif %}
            {% endif %}
        </h4>
        <p class="text-muted">
            {% if selected_main_category == '대회' %}
                {% if lang == 'en' %}Be the first to submit a competition!{% elif lang == 'ja' %}最初の大会を申請してください！{% elif lang == 'zh' %}快来申请第一个大赛吧！{% else %}첫 번째 대회를 신청해보세요!{% endif %}
            {% else %}
                {% if lang == 'en' %}Be the first to submit a performance!{% elif lang == 'ja' %}最初の公演を申請してください！{% elif lang == 'zh' %}快来申请第一个演出吧！{% else %}첫 번째 공연을 신청해보세요!{% endif %}
            {% endif %}
        </p>
        {% if current_user.is_authenticated %}
            <a href="/submit" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>
                {% if selected_main_category == '대회' %}
                    {% if lang == 'en' %}Submit Competition{% elif lang == 'ja' %}大会申請{% elif lang == 'zh' %}申请大赛{% else %}대회 신청하기{% endif %}
                {% else %}
                    {% if lang == 'en' %}Submit Performance{% elif lang == 'ja' %}公演申請{% elif lang == 'zh' %}申请演出{% else %}공연 신청하기{% endif %}
                {% endif %}
            </a>
        {% else %}
            <div class="d-flex gap-2 justify-content-center">
                <a href="/login" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt me-2"></i>
                    {% if lang == 'en' %}Login{% elif lang == 'ja' %}ログイン{% elif lang == 'zh' %}登录{% else %}로그인{% endif %}
                </a>
                <a href="/register" class="btn btn-outline-primary">
                    <i class="fas fa-user-plus me-2"></i>
                    {% if lang == 'en' %}Sign Up{% elif lang == 'ja' %}新規登録{% elif lang == 'zh' %}注册{% else %}회원가입{% endif %}
                </a>
            </div>
        {% endif %}
    </div>
    {% endif %}
</div>

<!-- 모바일 앱 다운로드 섹션 -->
<div class="mobile-app-section py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="mobile-app-content">
                    <h2 class="mobile-app-title">
                        <i class="fas fa-mobile-alt me-3 text-primary"></i>
                        모바일 앱으로 더 편리하게!
                    </h2>
                    <p class="mobile-app-description">
                        언제 어디서나 공연 정보를 확인하고 신청할 수 있는 모바일 앱을 다운로드하세요.
                        QR 코드를 스캔하여 즉시 다운로드할 수 있습니다.
                    </p>
                    
                    <div class="qr-code-container">
                        <div class="qr-code-wrapper">
                            <img id="mobileAppQR" src="" alt="앱 다운로드 QR코드" style="display: none; max-width: 200px; height: auto;">
                            <div class="qr-loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>QR 코드 생성 중...</span>
                            </div>
                        </div>
                        <p class="qr-instruction">QR 코드를 스캔하여 앱 다운로드</p>
                    </div>
                    
                    <div class="app-links">
                        <a href="#" class="btn btn-primary btn-lg me-3 mb-2">
                            <i class="fab fa-google-play me-2"></i>
                            Google Play
                        </a>
                        <a href="#" class="btn btn-primary btn-lg mb-2">
                            <i class="fab fa-apple me-2"></i>
                            App Store
                        </a>
                    </div>
                    
                    <div class="app-features">
                        <div class="feature-item">
                            <i class="fas fa-bell text-success"></i>
                            <span>실시간 푸시 알림</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-camera text-info"></i>
                            <span>카메라로 공연 신청</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-wifi text-warning"></i>
                            <span>오프라인 지원</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="mobile-app-preview">
                    <div class="phone-mockup">
                        <div class="phone-screen">
                            <div class="app-screenshot">
                                <div class="app-header">
                                    <h4>KOPIS 공연</h4>
                                    <p>다양한 공연을 만나보세요</p>
                                </div>
                                <div class="app-content">
                                    <div class="performance-card">
                                        <div class="card-image"></div>
                                        <div class="card-content">
                                            <h5>스트릿댄스 쇼케이스</h5>
                                            <p>홍대 거리에서 펼쳐지는 화려한 댄스 공연</p>
                                            <span class="price">₩15,000</span>
                                        </div>
                                    </div>
                                    <div class="performance-card">
                                        <div class="card-image"></div>
                                        <div class="card-content">
                                            <h5>힙합 댄스 배틀</h5>
                                            <p>최고의 댄서들이 모이는 배틀 대회</p>
                                            <span class="price">₩20,000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bg-light py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-4 mb-4">
                <i class="fas fa-theater-masks fa-3x text-primary mb-3"></i>
                <h4>다양한 예술의 만남</h4>
                <p class="text-muted">다양한 공연예술과 대회를 한 곳에서 만나보세요</p>
            </div>
            <div class="col-md-4 mb-4">
                <i class="fas fa-user-friends fa-3x text-primary mb-3"></i>
                <h4>누구나 쉽게 참여</h4>
                <p class="text-muted">누구나 쉽고 간편하게 공연과 대회를 신청하고 홍보할 수 있습니다</p>
            </div>
            <div class="col-md-4 mb-4">
                <i class="fas fa-globe-asia fa-3x text-primary mb-3"></i>
                <h4>예술로 소통하는 공간</h4>
                <p class="text-muted">예술을 사랑하는 모두가 함께 소통하고 성장하는 열린 무대입니다</p>
            </div>
        </div>
    </div>
</div>

<style>
/* 가격 범위 슬라이더 스타일 */
#customPriceRange {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.price-slider {
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    position: relative;
    margin: 10px 0;
}

.price-slider .ui-slider-range {
    background: #007bff;
    height: 100%;
    border-radius: 3px;
    position: absolute;
}

.price-slider .ui-slider-handle {
    width: 20px;
    height: 20px;
    background: #007bff;
    border: 2px solid #fff;
    border-radius: 50%;
    position: absolute;
    top: -7px;
    margin-left: -10px;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
}

.price-slider .ui-slider-handle:hover {
    background: #0056b3;
    transform: scale(1.1);
}

.price-slider .ui-slider-handle.ui-state-active {
    background: #0056b3;
    transform: scale(1.2);
}

/* 입력 필드 포커스 스타일 */
.price-range-container input:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

/* 모바일 앱 섹션 스타일 */
.mobile-app-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    position: relative;
    overflow: hidden;
}

.mobile-app-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
}

.mobile-app-content {
    position: relative;
    z-index: 2;
}

.mobile-app-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.mobile-app-description {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    opacity: 0.9;
}

.qr-code-container {
    text-align: center;
    margin-bottom: 2rem;
}

.qr-code-wrapper {
    display: inline-block;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    margin-bottom: 1rem;
}

.qr-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: #666;
    font-size: 0.9rem;
}

.qr-instruction {
    font-size: 0.9rem;
    opacity: 0.8;
    margin: 0;
}

.app-links {
    margin-bottom: 2rem;
}

.app-links .btn {
    background: rgba(255,255,255,0.2);
    border: 2px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.app-links .btn:hover {
    background: rgba(255,255,255,0.3);
    border-color: rgba(255,255,255,0.5);
    transform: translateY(-2px);
}

.app-features {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255,255,255,0.1);
    padding: 0.5rem 1rem;
    border-radius: 25px;
    backdrop-filter: blur(10px);
    font-size: 0.9rem;
}

.feature-item i {
    font-size: 1.1rem;
}

/* 폰 목업 스타일 */
.mobile-app-preview {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 2;
}

.phone-mockup {
    width: 280px;
    height: 560px;
    background: #1a1a1a;
    border-radius: 40px;
    padding: 8px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    position: relative;
}

.phone-mockup::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 4px;
    background: #333;
    border-radius: 2px;
}

.phone-screen {
    width: 100%;
    height: 100%;
    background: #f8f9fa;
    border-radius: 32px;
    overflow: hidden;
    position: relative;
}

.app-screenshot {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.app-header {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    padding: 2rem 1rem 1rem;
    text-align: center;
}

.app-header h4 {
    margin: 0 0 0.5rem 0;
    font-weight: 600;
}

.app-header p {
    margin: 0;
    opacity: 0.8;
    font-size: 0.9rem;
}

.app-content {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
}

.performance-card {
    background: white;
    border-radius: 12px;
    margin-bottom: 1rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.card-image {
    height: 80px;
    background: linear-gradient(45deg, #ff6b6b, #feca57);
}

.card-content {
    padding: 1rem;
}

.card-content h5 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    font-weight: 600;
}

.card-content p {
    margin: 0 0 0.5rem 0;
    font-size: 0.8rem;
    color: #666;
    line-height: 1.4;
}

.price {
    color: #007bff;
    font-weight: 600;
    font-size: 0.9rem;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .mobile-app-title {
        font-size: 2rem;
    }
    
    .mobile-app-preview {
        margin-top: 2rem;
    }
    
    .phone-mockup {
        width: 240px;
        height: 480px;
    }
    
    .app-features {
        justify-content: center;
    }
}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<script>
// 뒤로가기 방지 및 캐시 무효화
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        // 뒤로가기로 인한 페이지 로드 시 새로고침
        window.location.reload();
    }
});

// 브라우저 캐시 무효화
if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
    window.location.reload();
}

// 가격 필터 적용 함수
function applyPriceFilter(value) {
    if (value === 'custom') {
        // 사용자 지정 범위 선택 시 입력 필드 표시
        document.getElementById('customPriceRange').style.display = 'block';
        return;
    } else {
        // 사용자 지정 범위가 아닌 경우 입력 필드 숨김
        document.getElementById('customPriceRange').style.display = 'none';
    }
    
    if (!value) {
        // 전체 가격 선택 시 필터 제거
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.delete('price_min');
        urlParams.delete('price_max');
        urlParams.delete('price_range');
        window.location.href = '/' + (urlParams.toString() ? '?' + urlParams.toString() : '');
        return;
    }
    
    // 미리 정의된 범위 파싱
    const [min, max] = value.split('-').map(Number);
    
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.set('price_min', min);
    urlParams.set('price_max', max);
    urlParams.set('price_range', value);
    
    window.location.href = '/' + (urlParams.toString() ? '?' + urlParams.toString() : '');
}

// 필터 적용 함수
function applyFilter(filterType, value) {
    const urlParams = new URLSearchParams(window.location.search);
    
    if (value) {
        urlParams.set(filterType, value);
    } else {
        urlParams.delete(filterType);
    }
    
    window.location.href = '/' + (urlParams.toString() ? '?' + urlParams.toString() : '');
}

// 사용자 지정 가격 범위 적용 함수
function applyCustomPriceRange() {
    const priceMin = document.getElementById('priceMin').value;
    const priceMax = document.getElementById('priceMax').value;
    
    const urlParams = new URLSearchParams(window.location.search);
    
    if (priceMin) {
        urlParams.set('price_min', priceMin);
    } else {
        urlParams.delete('price_min');
    }
    
    if (priceMax) {
        urlParams.set('price_max', priceMax);
    } else {
        urlParams.delete('price_max');
    }
    
    urlParams.set('price_range', 'custom');
    
    window.location.href = '/' + (urlParams.toString() ? '?' + urlParams.toString() : '');
}

// 가격 슬라이더 초기화
document.addEventListener('DOMContentLoaded', function() {
    // 사용자 지정 범위가 선택되어 있으면 입력 필드 표시
    const priceRange = '{{ price_range or "" }}';
    if (priceRange === 'custom') {
        document.getElementById('customPriceRange').style.display = 'block';
    }
    
    // jQuery UI 슬라이더 초기화
    if ($.fn.slider) {
        const priceMinValue = parseInt('{{ price_min or 0 }}');
        const priceMaxValue = parseInt('{{ price_max or 2000000 }}');
        
        $('#priceSlider').slider({
            range: true,
            min: 0,
            max: 2000000,
            step: 10000,
            values: [priceMinValue, priceMaxValue],
            slide: function(event, ui) {
                $('#priceMin').val(ui.values[0]);
                $('#priceMax').val(ui.values[1]);
            },
            stop: function(event, ui) {
                // 슬라이더가 멈추면 자동으로 필터 적용
                applyCustomPriceRange();
            }
        });
        
        // 입력 필드 변경 시 슬라이더 업데이트
        $('#priceMin, #priceMax').on('change', function() {
            const min = parseInt($('#priceMin').val()) || 0;
            const max = parseInt($('#priceMax').val()) || 2000000;
            $('#priceSlider').slider('values', [min, max]);
        });
    }
    
    // 좋아요 기능
    const likeButtons = document.querySelectorAll('.like-btn');
    
    likeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const performanceId = this.dataset.performanceId;
            const likeCount = this.querySelector('.like-count');
            
            fetch('/like/' + performanceId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    likeCount.textContent = data.likes;
                    if (data.liked) {
                        this.classList.remove('btn-outline-danger');
                        this.classList.add('btn-danger');
                    } else {
                        this.classList.remove('btn-danger');
                        this.classList.add('btn-outline-danger');
                    }
                } else {
                    alert('로그인이 필요합니다.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('오류가 발생했습니다.');
            });
        });
    });
});

// 모바일 앱 QR 코드 로드
function loadMobileAppQR() {
    fetch('/api/qr-code')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const qrImage = document.getElementById('mobileAppQR');
                qrImage.src = 'data:image/png;base64,' + data.qr_code;
                qrImage.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('QR 코드 로드 오류:', error);
        });
}

// 페이지 로드 시 QR 코드 생성
document.addEventListener('DOMContentLoaded', function() {
    loadMobileAppQR();
});
</script>
{% endblock %} 