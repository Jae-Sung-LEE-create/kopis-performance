{% extends "base.html" %}

{% block title %}{% if lang == 'en' %}Market Analytics{% elif lang == 'ja' %}市場分析{% elif lang == 'zh' %}市场分析{% else %}시장 분석{% endif %}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        {% if lang == 'en' %}Market Analytics Dashboard{% elif lang == 'ja' %}市場分析ダッシュボード{% elif lang == 'zh' %}市场分析仪表板{% else %}공연시장 분석 대시보드{% endif %}
                    </h3>
                </div>
                <div class="card-body">
                    <!-- 전체 통계 -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h4>{{ total_performances }}</h4>
                                    <p class="mb-0">{% if lang == 'en' %}Total Performances{% elif lang == 'ja' %}総公演数{% elif lang == 'zh' %}总演出数{% else %}전체 공연 수{% endif %}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h4>{{ categories|length }}</h4>
                                    <p class="mb-0">{% if lang == 'en' %}Categories{% elif lang == 'ja' %}カテゴリ{% elif lang == 'zh' %}类别{% else %}카테고리 수{% endif %}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h4>{{ locations|length }}</h4>
                                    <p class="mb-0">{% if lang == 'en' %}Locations{% elif lang == 'ja' %}場所{% elif lang == 'zh' %}地点{% else %}지역 수{% endif %}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h4>{{ market_gaps.opportunities|length }}</h4>
                                    <p class="mb-0">{% if lang == 'en' %}Opportunities{% elif lang == 'ja' %}機会{% elif lang == 'zh' %}机会{% else %}기회 요소{% endif %}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 카테고리별 분포 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-pie-chart me-2"></i>{% if lang == 'en' %}Category Distribution{% elif lang == 'ja' %}カテゴリ分布{% elif lang == 'zh' %}类别分布{% else %}카테고리별 분포{% endif %}</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="categoryChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-map-marker-alt me-2"></i>{% if lang == 'en' %}Location Distribution{% elif lang == 'ja' %}場所分布{% elif lang == 'zh' %}地点分布{% else %}지역별 분포{% endif %}</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="locationChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 시장 기회 -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <h5><i class="fas fa-lightbulb me-2"></i>{% if lang == 'en' %}Market Opportunities{% elif lang == 'ja' %}市場機会{% elif lang == 'zh' %}市场机会{% else %}시장 기회{% endif %}</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        {% for opportunity in market_gaps.opportunities %}
                                        <div class="col-md-4 mb-3">
                                            <div class="alert alert-info">
                                                <i class="fas fa-star me-2"></i>{{ opportunity }}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 카테고리 차트
const categoryCtx = document.getElementById('categoryChart').getContext('2d');
const categoryChart = new Chart(categoryCtx, {
    type: 'pie',
    data: {
        labels: {{ categories.keys() | list | tojson }},
        datasets: [{
            data: {{ categories.values() | list | tojson }},
            backgroundColor: [
                '#FF6384',
                '#36A2EB',
                '#FFCE56',
                '#4BC0C0',
                '#9966FF',
                '#FF9F40',
                '#FF6384',
                '#C9CBCF',
                '#4BC0C0'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});

// 지역 차트
const locationCtx = document.getElementById('locationChart').getContext('2d');
const locationChart = new Chart(locationCtx, {
    type: 'bar',
    data: {
        labels: {{ locations.keys() | list | tojson }},
        datasets: [{
            label: '{% if lang == "en" %}Performances{% elif lang == "ja" %}公演数{% elif lang == "zh" %}演出数{% else %}공연 수{% endif %}',
            data: {{ locations.values() | list | tojson }},
            backgroundColor: '#36A2EB',
            borderColor: '#2693e6',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
</script>
{% endblock %} 